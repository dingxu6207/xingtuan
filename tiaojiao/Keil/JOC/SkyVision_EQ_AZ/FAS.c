/*************************************************************************************
函数名称: FindAlignStar
功能描述: 导入校准星表，找出当前时刻可用于校准的星
   参数说明：fstime : 当前恒星时
			 flat：   当前纬度
			 fraddec：指针，用于存储可用于校准星的赤经和赤纬*fraddec=第一颗星赤经
			           										*（fraddec+1）=第一颗星赤纬
															*（fraddec+2）=第二颗星赤经
															*（fraddec+3）=第二颗星赤纬
															....
   返回值：返回当前可用于校准星的颗数
*************************************************************************************/

#define Star_number   28 
char Align_Star_NameEn[28][10]={{'S','i','r','i','u','s',' ',' ',' ',0},
							 {'C','a','n','o','p','u','s',' ',' ',0},
							 {'V','e','g','a',' ',' ',' ',' ',' ',0},	   
							 {'A','l','p','h','a',' ','C','e','n',0},
							 {'A','r','c','t','u','r','u','s',' ',0},
							 {'C','a','p','e','l','l','a',' ',' ',0},
							 {'R','i','g','e','l',' ',' ',' ',' ',0},
							 {'P','r','o','c','y','o','n',' ',' ',0},
							 {'A','c','h','e','r','n','a','r',' ',0}, 
							 {'B','e','t','e','l','g','e','u','s',0},
							 {'A','l','t','a','i','r',' ',' ',' ',0},
							 {'A','l','d','e','b','a','r','a','n',0},
							 {'S','p','i','c','a',' ',' ',' ',' ',0},
							 {'A','n','t','a','r','e','s',' ',' ',0},
							 {'F','o','m','a','l','h','a','u','t',0},
							 {'D','e','n','e','b',' ',' ',' ',' ',0},
							 {'R','e','g','u','l','u','s',' ',' ',0},
							 {'M','i','r','f','a','k',' ',' ',' ',0},
							 {'C','a','s','t','o','r',' ',' ',' ',0},
							 {'A','l','p','h','a','r','d',' ',' ',0},
							 {'P','o','l','a','r','i','s',' ',' ',0},
							 {'A','l','p','h','e','r','a','t','z',0},
  						     {'R','a','s','a','l','h','a','g','u',0},
							 {'D','e','n','e','b','o','l','a',' ',0},
							 {'N','a','v','i',' ',' ',' ',' ',' ',0},
							 {'S','u','h','a','i','l',' ',' ',' ',0},
							 {'M','i','z','a','r',' ',' ',' ',' ',0},
							 {'A','l','b','i','r','e','o',' ',' ',0}};
							 

  char  Align_Star_NameCn[28][22]={{0x29,0x59,0xFC,0x72,0x20,0x00,0x27,0x59,0xAC,0x72,0xA7,0x5E,0xB1,0x03,0x20,0x00,0x20,0x00,0x20,0x00,0x00,0x00},
								 {0x01,0x80,0xBA,0x4E,0x1F,0x66,0x20,0x00,0x39,0x82,0x95,0x5E,0xA7,0x5E,0xA7,0x5E,0xB1,0x03,0x20,0x00,0x00,0x00},
								 {0xC7,0x7E,0x73,0x59,0x00,0x4E,0x20,0x00,0x20,0x00,0x29,0x59,0x34,0x74,0xA7,0x5E,0xB1,0x03,0x20,0x00,0x00,0x00},	   
								 {0x4A,0x53,0xBA,0x4E,0x6C,0x9A,0xA7,0x5E,0xA7,0x5E,0xB1,0x03,0x20,0x00,0x20,0x00,0x20,0x00,0x20,0x00,0x00,0x00},
							     {0x27,0x59,0xD2,0x89,0x20,0x00,0x67,0x72,0x2B,0x59,0xA7,0x5E,0xB1,0x03,0x20,0x00,0x20,0x00,0x20,0x00,0x00,0x00},
							  	 {0x94,0x4E,0x66,0x8F,0x8C,0x4E,0x20,0x00,0xA1,0x5F,0x2B,0x59,0xA7,0x5E,0xB1,0x03,0x20,0x00,0x20,0x00,0x00,0x00},
								 {0xC2,0x53,0xBF,0x5B,0x03,0x4E,0x20,0x00,0x0E,0x73,0x37,0x62,0xA7,0x5E,0xB2,0x03,0x20,0x00,0x20,0x00,0x00,0x00},
								 {0x57,0x53,0xB3,0x6C,0x09,0x4E,0x20,0x00,0x0F,0x5C,0xAC,0x72,0xA7,0x5E,0xB1,0x03,0x20,0x00,0x20,0x00,0x00,0x00},
								 {0x34,0x6C,0xD4,0x59,0x00,0x4E,0x20,0x00,0xE2,0x6C,0x5F,0x6C,0xA7,0x5E,0xA7,0x5E,0xB1,0x03,0x20,0x00,0x00,0x00}, 
								 {0xC2,0x53,0xBF,0x5B,0xDB,0x56,0x20,0x00,0x0E,0x73,0x37,0x62,0xA7,0x5E,0xB1,0x03,0x20,0x00,0x20,0x00,0x00,0x00},
								 {0xB3,0x6C,0x13,0x9F,0x8C,0x4E,0x20,0x00,0x29,0x59,0x70,0x9E,0xA7,0x5E,0xB1,0x03,0x20,0x00,0x20,0x00,0x00,0x00},
								 {0xD5,0x6B,0xBF,0x5B,0x94,0x4E,0x20,0x00,0xD1,0x91,0x5B,0x72,0xA7,0x5E,0xB1,0x03,0x20,0x00,0x20,0x00,0x00,0x00},
								 {0xD2,0x89,0xBF,0x5B,0x00,0x4E,0x20,0x00,0xA4,0x5B,0x73,0x59,0xA7,0x5E,0xB1,0x03,0x20,0x00,0x20,0x00,0x00,0x00},
								 {0xC3,0x5F,0x27,0x59,0x1F,0x66,0x20,0x00,0x29,0x59,0x4E,0x87,0xA7,0x5E,0xB1,0x03,0x20,0x00,0x20,0x00,0x00,0x00},
								 {0x17,0x53,0x3D,0x84,0x08,0x5E,0xE8,0x95,0x20,0x00,0x20,0x00,0x57,0x53,0x7C,0x9C,0xA7,0x5E,0xB1,0x03,0x00,0x00},
								 {0x29,0x59,0x25,0x6D,0xDB,0x56,0x20,0x00,0x29,0x59,0x45,0x9E,0xA7,0x5E,0xB1,0x03,0x20,0x00,0x20,0x00,0x00,0x00},
								 {0x69,0x8F,0x95,0x8F,0x41,0x53,0xDB,0x56,0xEE,0x72,0x50,0x5B,0xA7,0x5E,0xB1,0x03,0x20,0x00,0x20,0x00,0x00,0x00},
								 {0x29,0x59,0x39,0x82,0x09,0x4E,0x20,0x00,0xF1,0x82,0xD9,0x4E,0xA7,0x5E,0xB1,0x03,0x20,0x00,0x20,0x00,0x00,0x00},
								 {0x17,0x53,0xB3,0x6C,0x8C,0x4E,0x20,0x00,0xCC,0x53,0x50,0x5B,0xA7,0x5E,0xB1,0x03,0x20,0x00,0x20,0x00,0x00,0x00},
								 {0x1F,0x66,0xBF,0x5B,0x00,0x4E,0x20,0x00,0x7F,0x95,0xC7,0x86,0xA7,0x5E,0xB1,0x03,0x20,0x00,0x20,0x00,0x00,0x00},
								 {0x0F,0x5C,0x8A,0x71,0xA7,0x5E,0xA7,0x5E,0xB1,0x03,0x20,0x00,0x20,0x00,0x20,0x00,0x20,0x00,0x20,0x00,0x00,0x00},
								 {0xC1,0x58,0xBF,0x5B,0x8C,0x4E,0x20,0x00,0xD9,0x4E,0x73,0x59,0xA7,0x5E,0xB1,0x03,0x20,0x00,0x20,0x00,0x00,0x00},
	  						     {0xAF,0x4F,0x20,0x00,0xC7,0x86,0x2B,0x59,0xA7,0x5E,0xB1,0x03,0x20,0x00,0x20,0x00,0x20,0x00,0x20,0x00,0x00,0x00},
								 {0x94,0x4E,0x1D,0x5E,0xA7,0x5E,0x00,0x4E,0xEE,0x72,0x50,0x5B,0xA7,0x5E,0xB2,0x03,0x20,0x00,0x20,0x00,0x00,0x00},
								 {0xD9,0x4E,0x0E,0x54,0xA7,0x5E,0xB3,0x03,0x20,0x00,0x20,0x00,0x20,0x00,0x20,0x00,0x20,0x00,0x20,0x00,0x00,0x00},
								 {0x01,0x80,0xBA,0x4E,0x1F,0x66,0x20,0x00,0x39,0x82,0x06,0x5E,0xA7,0x5E,0xBB,0x03,0x20,0x00,0x20,0x00,0x00,0x00},
								 {0x00,0x5F,0x33,0x96,0x20,0x00,0x27,0x59,0x8A,0x71,0XA7,0X5E,0xB6,0x03,0x20,0x00,0x20,0x00,0x20,0x00,0x00,0x00},
								 {0x87,0x8F,0x53,0x90,0x9E,0x58,0x03,0x4E,0x29,0x59,0x45,0x9E,0xA7,0x5E,0xB2,0x03,0x20,0x00,0x20,0x00,0x00,0x00}};

																									   

uint8 FindAlignStar(float fstime,float flat,float* fraddec,char Align_Star_Name[10][10],char Align_Star_NameCnn[10][22])		
{
	float Star_arr_ra[Star_number];
	float Star_arr_dec[Star_number]; 

	char   arra[20];
	char   arrb[10][10];
	int 	i;
	uint8 	j;
	uint8   k;
	uint8   n;
	float lat_low;
	float lat_high;
	float lon_low;
	float lon_high;
	

	 

//inport the standard star table
//	for(i=0;i<Star_number;i++)
//	{	
//		GetCalibrateStarInfo(i,&Star_arr_ra[i],&Star_arr_dec[i]);
//	}

	Star_arr_ra[0]=6.7585;
	Star_arr_dec[0]=-16.72630555;
	Star_arr_ra[1]=6.40180278;
	Star_arr_dec[1]=-52.6982499;
	Star_arr_ra[2]=18.620930;
	Star_arr_dec[2]=38.790943;
	Star_arr_ra[3]=14.670347;
	Star_arr_dec[3]=-60.875278;
	Star_arr_ra[4]=14.267856;
	Star_arr_dec[4]=19.138472;
	Star_arr_ra[5]=5.288405;
	Star_arr_dec[5]=46.006638;
	Star_arr_ra[6]=5.248961;
	Star_arr_dec[6]=-8.189528;
	Star_arr_ra[7]=7.662292;
	Star_arr_dec[7]=5.204333;
	Star_arr_ra[8]=1.633978;
	Star_arr_dec[8]=-57.187054;
	Star_arr_ra[9]=5.093711;
	Star_arr_dec[9]=7.410167;
	Star_arr_ra[10]=19.853836;
	Star_arr_dec[10]=8.890472;
	Star_arr_ra[11]=4.606700;
	Star_arr_dec[11]=16.527527;
	Star_arr_ra[12]=13.427614;
	Star_arr_dec[12]=-11.207945;
	Star_arr_ra[13]=16.499397;
	Star_arr_dec[13]=-26.453333;
	Star_arr_ra[14]=22.969114;
	Star_arr_dec[14]=-29.573389;
	Star_arr_ra[15]=20.695877;
	Star_arr_dec[15]=45.308834;
	Star_arr_ra[16]=10.147056;
	Star_arr_dec[16]=11.926416;	
	Star_arr_ra[17]=3.415389;
	Star_arr_dec[17]=49.890057;
	Star_arr_ra[18]=7.585497;
	Star_arr_dec[18]=31.871056;
	Star_arr_ra[19]=9.466641;
	Star_arr_dec[19]=-8.695806;
	Star_arr_ra[20]=2.679011;
	Star_arr_dec[20]=89.298111;
	Star_arr_ra[21]=0.147342;
	Star_arr_dec[21]=29.136417;
	Star_arr_ra[22]=17.589369;
	Star_arr_dec[22]=12.553306;
	Star_arr_ra[23]=11.825017;
	Star_arr_dec[23]=14.525111;
	Star_arr_ra[24]=0.953800;
	Star_arr_dec[24]=60.759693;
	Star_arr_ra[25]=9.138127;
	Star_arr_dec[25]=-43.468777;
	Star_arr_ra[26]=13.404866;
	Star_arr_dec[26]=54.884029;
	Star_arr_ra[27]=19.518867;
	Star_arr_dec[27]=27.982250;

	if(fstime>=4||fstime<=20)
	{
		lon_low=fstime-4;
		lon_high=fstime+4;
	}
	else if(fstime<4)
	{
		lon_low=fstime+24-4;
		lon_high=fstime+4;
	}
	else
	{
		lon_low=fstime-4;
		lon_high=fstime-24+4;
	}
	if(flat>=0)
	{
		lat_low=flat-60;
		lat_high=flat+60;
		if(lat_high>90)
		lat_high=90;
	}
	else
	{
		lat_low=flat-60;
		lat_high=flat+60;
		if(lat_low<(-90))
		lat_low=(-90);
	}
	for(i=0,j=0;i<Star_number;i++)
	{
		if((fstime>=4)||(fstime<=20))
		{
			if((Star_arr_ra[i]>=lon_low)&&(Star_arr_ra[i]<=lon_high))
			{
				if((Star_arr_dec[i]>=lat_low)&&(Star_arr_dec[i]<=lat_high))
				{
					arra[j]=i;
					j++;
				}
			}
		}
		else if((fstime<=4)||(fstime>=20))
		{
			if(((Star_arr_ra[i]>=lon_low)&&(Star_arr_ra[i]<=24))||((Star_arr_ra[i]>=0)&&(Star_arr_ra[i]<=lon_high)))
			{
				if((Star_arr_dec[i]>=lat_low)&&(Star_arr_dec[i]<=lat_high))
				{
					arra[j]=i;
					j++;
				}
			}
		}
	}
	if(j>0)
	{
		for(i=0;i<=(j-1);i++)
		{
			*(fraddec+2*i)=Star_arr_ra[arra[i]];
			*(fraddec+2*i+1)=Star_arr_dec[arra[i]];
			for(k=0;k<10;k++) 					
			  Align_Star_Name[i][k]=Align_Star_NameEn[arra[i]][k];
	    	for(n=0;n<22;n++)  
			  Align_Star_NameCnn[i][n]=Align_Star_NameCn[arra[i]][n];
			
			
			
		}
	}
	return (j-1);

}
